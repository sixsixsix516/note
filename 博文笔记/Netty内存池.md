### Netty内存池



#### 为什么需要池化内存？

​	netty使用堆外内存非常高频（Direct ByteBuffer）

​	堆外内存在JVM之外，有效降低JVM GC压力，提高传输性能

​	创建堆外内存速度比堆内存慢了10-20倍



**内存池： 池化管理、多次重用**



内存管理算法jemalloc：减少内存碎片、提示内存分配效率

netty4.1.0 采用 jemalloc3.x算法。netty4.1.45以后采用jemalloc4.x算法



内存碎片

在Linux，物理内存被划分若干个4kb内存页（page），分配和回收都是基于page完成。

page内产生的碎片为内部碎片、外部为外部碎片

碎片：碎片很小、存在很多、无法分配使用



**内存分配算法**

##### 1. 动态内存分配 / 堆内存分配

按需分配内存



分配策略：

1. 首次适应算法

   空闲内存按照内存起始地址从低到高的顺序以双向链表形式链接在一起。分配时从低地址开始查找并分配。（导致低地址使用率高）

2. 循环首次适应算法

   首次适应算法的变种，第二次的分配从下一个空闲内存开始查找。（较之前均匀）

3. 最佳适应算法

   内存空间大小 从小到大排序，内存分配从头开始查询适合的空间并分配。分配完成后，空闲内存空间链表重新排序

问题：

​	导致严重内存碎片



##### 2. 伙伴算法

按照不同的规格，以块为单位进行分配。

系统中的内存按照相邻关系，两两分组，每组中的两个内存块称作伙伴。伙伴可分开和合并。





##### 3. Slab算法





